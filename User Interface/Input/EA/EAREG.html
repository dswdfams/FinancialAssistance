<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900&display=swap" rel="stylesheet" />
    <link rel="stylesheet" href="EAREG.css" />
    <link rel="stylesheet" href="/User Interface/footer-nav-user.css">
    <title>Educational Assistance</title>
    <style>
   
        /* Modal styling */
        .modal {
            display: none;
            position: absolute;
            width: 100%;
            height: 189vh;
            background-color: rgba(0, 0, 0, 0.5);
            
          justify-content: center;
          align-items: center;
           
        }
                /* .modal-content{   

                    background-color: white;
                            padding: 20px;
                            border-radius: 10px;
                            width: 90%;
                            max-width: 500px;
                            text-align: justify
                            h
                        
                            
                    
                } */

         
        .modal-content{
            background-color: white;
            padding: 20px;
            border-radius: 10px;
            width: 500px;
            height: 600px;
       
    
          
        }

        .modal-header {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 10px;
            
        }

        .modal-body {
            padding: 0px 30px 0px 0px;
height: 90%;
            margin-bottom: 20px;
           
            overflow-y: scroll; 
            display: flex;
            justify-content: start;
            flex-direction: column;
        }

        .modal button {
            margin: 10px 5px;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        .modal strong{
            list-style: none;
        }
        #content-head{
            list-style: none;
        }
        ul li{
            margin: 10px 0px 10px 0px;
    
            
        }
        ul li {
            color: #0c77a8;
        }
        .overflowcont::-webkit-scrollbar {
  width: 10px; /* Scroll bar width */
}

/* Thumb */
.modal-body::-webkit-scrollbar-thumb {
  background: #8dbfd6; /* Color of the thumb */
  border-radius: 5px; /* Round edges */
}

/* Hover effect on thumb */
.modal-body::-webkit-scrollbar-thumb:hover {
  background: #0c77a8;/* Darker color on hover */
}

/* Track (Background) */
.modal-body::-webkit-scrollbar-track {
  background: #f1f1f1; /* Track background color */
  border-radius: 5px; /* Round edges for consistency */
}
.modal-body::-webkit-scrollbar {
  width: 10px; /* Scroll bar width */
}

/* Thumb */
.modal-body::-webkit-scrollbar-thumb {
  background: #8dbfd6; /* Color of the thumb */
  border-radius: 5px; /* Round edges */
}

/* Hover effect on thumb */
.modal-body::-webkit-scrollbar-thumb:hover {
  background: #0c77a8;/* Darker color on hover */
}

/* Track (Background) */
.modal-body::-webkit-scrollbar-track {
  background: #f1f1f1; /* Track background color */
  border-radius: 5px; /* Round edges for consistency */
}
.terms-and-conditions{
    margin-top: 10px;
}

    
    </style>
</head>

<body>
    <nav>
        <!-- Navigation code -->
    </nav>

    <div class="maincont">
        <div class="bcont">
            <div class="title">
                <p style="font-size: 26px">EDUCATIONAL ASSISTANCE</p>
            </div>
            <div class="title2"><label>REQUIRED DOCUMENT/S</label></div>

            <div class="regcont">
                <div class="cont">
                    <div class="inputcont">
                        <div><input type="text" placeholder="First Name" id="firstname" required /></div>
                        <div>
                            <input type="text" placeholder="Middle Name" id="middlename" />
                            <div class="mlabel">
                                <input type="checkbox" id="nomiddlename" />
                                <label for="nomiddlename" class="mid">I don't have a middle name</label>
                            </div>
                        </div>
                        <div><input type="text" placeholder="Last Name" id="lastname" required /></div>
                    </div>

                    <div class="inputcont2">
                        <div><input type="text" placeholder="Phone Number" id="contactNumber" required /></div>
                        <div><input type="text" placeholder="Name of School" id="schoolName" required /></div>
                        <div><input type="text" placeholder="Year Level" id="yearlevel" required /></div>
                    </div>

                    <div class="inputcont3">
                        <div><input type="text" placeholder="Full Address" id="address" required /></div>
                    </div>
                </div>
            </div>

            <div class="regcont2">
                <div class="inputcont4">
                    <div class="filecontainer">
                        <div class="fileup">
                            <input type="file" id="COE" name="COE" required />
                            <label for="COE">Certificate of Enrollment</label>
                            <p id="fileName" style="margin-top: 10px; color: green;"></p>
                            <progress id="coeProgress" value="0" max="100" style="display: none; margin-top: 10px;"></progress>
                        </div>
                    </div>
                </div>
            </div>

            <div class="terms-and-conditions" >
                <input type="checkbox" id="terms" disabled />
                <label for="terms" id="termsLabel">I agree to the <a href="#" id="showTerms">Terms and Conditions</a>.</label>
            </div>

            <div class="buttons">
                <a href="/index.html"><button>Cancel</button></a>
                <button id="nextBtn">Next</button>
            </div>
        </div>
    </div>

    <!-- Review Modal -->
    <div id="reviewModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">Review Your Application</div>
            <div class="modal-body">
                <p><strong>First Name:</strong> <span id="reviewFirstName"></span></p>
                <p><strong>Middle Name:</strong> <span id="reviewMiddleName"></span></p>
                <p><strong>Last Name:</strong> <span id="reviewLastName"></span></p>
                <p><strong>Phone Number:</strong> <span id="reviewPhone"></span></p>
                <p><strong>School Name:</strong> <span id="reviewSchoolName"></span></p>
                <p><strong>Year Level:</strong> <span id="reviewYearLevel"></span></p>
                <p><strong>Address:</strong> <span id="reviewAddress"></span></p>
            </div>
            <button id="editBtn">Edit</button>
            <button id="confirmBtn">Confirm</button>
        </div>
    </div>

    <!-- Terms and Conditions Modal -->
   
    <div id="termsModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">Terms and Conditions</div>
            <div class="modal-body">
                <p>Terms and Conditions for DSWD Financial Assistance
                    By using the DSWD Financial Assistance Management System (FAMS), you agree to the following terms and conditions:<br><br>
                    
                  <ul>
  <li id="content-head"><strong>Eligibility Requirements</strong>
    <ul>
      <li>You must be a resident of the Philippines.</li>
      <li>You must meet the eligibility criteria for the specific type of assistance (e.g., AICS, SCA, PWD, or EAR).</li>
      <li>You must provide accurate and up-to-date information in the registration form.</li>
    </ul>
  </li>
  <li id="content-head"><strong>Application Process</strong>
    <ul>
      <li>You can only submit one application for assistance at a time. If you have already submitted an application and it is still pending or accepted, you are not eligible to submit a new application.</li>
      <li>If your previous application has been rejected, you may submit a new application.</li>
      <li>You are responsible for ensuring the accuracy of the information provided. Providing false or misleading information may result in the rejection of your application or legal consequences.</li>
    </ul>
  </li>
  <li id="content-head"><strong>Status of Application</strong>
    <ul>
      <li><strong>Pending:</strong> Your application is under review.</li>
      <li><strong style="color:rgb(92, 198, 92); ">Accepted:</strong> Your application has been approved and a payout will be processed.</li>
      <li><strong style="color:red ;" >Rejected:</strong> Your application has been rejected, and the reason will be provided. You may be eligible to resubmit if the application was rejected.</li>
      <li><strong>Payout Information:</strong> If your application is accepted, a payout date will be scheduled. The amount and date will be provided based on your eligibility.</li>
    </ul>
  </li>
  <li id="content-head"><strong>Use of Personal Information</strong>
    <ul>
      <li>By submitting your application, you consent to the collection and processing of your personal information by the DSWD for the purpose of administering the financial assistance program.</li>
      <li>Your personal information will be stored securely in accordance with applicable data protection laws.</li>
    </ul>
  </li>
  <li id="content-head"><strong>Resubmission of Application</strong>
    <ul>
      <li>If your previous application was rejected, you may be allowed to resubmit your application after addressing the reason for rejection.</li>
      <li>You must comply with the requirements set by the DSWD for resubmission.</li>
    </ul>
  </li>
  <li id="content-head"><strong>Fraud and Misuse</strong>
    <ul>
      <li>You are prohibited from engaging in fraudulent activities, including submitting false information or attempting to manipulate the application system.</li>
      <li>Any form of fraud or misuse will result in immediate rejection of the application and potential legal action.</li>
    </ul>
  </li>
  <li id="content-head"><strong>No Guarantee of Assistance</strong>
    <ul>
      <li>The submission of an application does not guarantee approval of financial assistance. The DSWD will review each application based on eligibility and available funds.</li>
    </ul>
  </li>
  <li id="content-head"><strong>Terms and Conditions Updates</strong>
    <ul>
      <li>The DSWD reserves the right to modify, update, or discontinue the terms and conditions at any time without notice. You will be informed of significant changes via the application portal.</li>
    </ul>
  </li>
  <li id="content-head"><strong>Governing Law</strong>
    <ul>
      <li>These terms and conditions are governed by the laws of the Philippines, and any disputes will be subject to the exclusive jurisdiction of the Philippine courts.</li>
    </ul>
  </li>
 
</ul>
<p>For any questions regarding these terms, you can contact the DSWD at: <br>
    DSWD Central Office, Constitution Hills, Batasan Complex, Quezon City, Philippines 1126 <br><br>
    ‚òéÔ∏è (632) 8-931-81-01 to 07<br>
    üì≤ GLOBE: 09171105686 and 09178272543<br>
    üì≤ SMART: 09199116200<br>
    üìß inquiry@dswd.gov.ph </p>
                    <button id="agreeBtn">Agree</button>
            </div>
          
        </div>
    </div>

    <footer>
        <!-- Footer code -->
    </footer>

    <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-storage.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-database.js"></script>

    <script>
      const firebaseConfig = {
            apiKey: "AIzaSyDiOsr6bY5BDKdiBPRzDgSpurHdkkUlc3k",
            authDomain: "sia101-d60a1.firebaseapp.com",
            databaseURL: "https://sia101-d60a1-default-rtdb.firebaseio.com",
            projectId: "sia101-d60a1",
            storageBucket: "sia101-d60a1.appspot.com",
            messagingSenderId: "258109532727",
            appId: "1:258109532727:web:73d735dc749d2cb4ebedb2"
        };

firebase.initializeApp(firebaseConfig);
const database = firebase.database();
const storage = firebase.storage();

// DOM Elements
const firstName = document.getElementById("firstname");
const middleName = document.getElementById("middlename");
const lastName = document.getElementById("lastname");
const contactNumber = document.getElementById("contactNumber");
const schoolName = document.getElementById("schoolName");
const yearLevel = document.getElementById("yearlevel");
const address = document.getElementById("address");
const coeInput = document.getElementById("COE");
const fileNameDisplay = document.getElementById("fileName");
const coeProgress = document.getElementById("coeProgress");
const reviewModal = document.getElementById("reviewModal");
const termsModal = document.getElementById("termsModal");
const termsCheckbox = document.getElementById("terms");
const agreeBtn = document.getElementById("agreeBtn");
const reviewFirstName = document.getElementById("reviewFirstName");
const reviewMiddleName = document.getElementById("reviewMiddleName");
const reviewLastName = document.getElementById("reviewLastName");
const reviewPhone = document.getElementById("reviewPhone");
const reviewSchoolName = document.getElementById("reviewSchoolName");
const reviewYearLevel = document.getElementById("reviewYearLevel");
const reviewAddress = document.getElementById("reviewAddress");

const queryString = window.location.search;
const urlParams = new URLSearchParams(queryString);
const data = Object.fromEntries(urlParams.entries());

// Pre-fill fields if data exists
firstName.value = data.firstName || "";
middleName.value = data.middleName || "";
lastName.value = data.lastName || "";
contactNumber.value = data.mobileNumber || "";
schoolName.value = data.schoolName || "";
yearLevel.value = data.yearLevel || "";
address.value = data.address || "";

// File upload handling
coeInput.addEventListener("change", async (event) => {
    const file = event.target.files[0];
    if (file) {
        fileNameDisplay.textContent = `Selected file: ${file.name}`;
        coeProgress.style.display = "block";

        try {
            const newId = await generateID();
            const fileRef = storage.ref(`COE/${newId}_${file.name}`);
            const uploadTask = fileRef.put(file);

            uploadTask.on(
                "state_changed",
                (snapshot) => {
                    const progress = (snapshot.bytesTransferred / snapshot.totalBytes) * 100;
                    coeProgress.value = progress;
                },
                (error) => {
                    console.error("File upload error:", error);
                    alert("An error occurred during the upload.");
                },
                async () => {
                    const downloadURL = await fileRef.getDownloadURL();
                    data.coeUrl = downloadURL; // Save file URL for later use
                    alert("File uploaded successfully!");
                }
            );
        } catch (error) {
            console.error("Error uploading file:", error);
            alert("An error occurred.");
        }
    }
});

// Modal handling for Terms and Conditions
document.getElementById("showTerms").addEventListener("click", (e) => {
    e.preventDefault();
    termsModal.style.display = "flex";
});

agreeBtn.addEventListener("click", () => {
    termsModal.style.display = "none";
    termsCheckbox.checked = true;
});

// Review modal handling
document.getElementById("nextBtn").addEventListener("click", async () => {
    try {
        if (!validateFields()) return;

        const residentId = data.residentId || "unknown";

        const existingApplication = await checkExistingApplication(residentId);
        if (existingApplication) {
            alert("You already have an existing application.");
            return;
        }

        const lastPayout = await checkLastPayoutDate(residentId);
        if (lastPayout) {
            alert("You are not eligible to reapply yet.");
            return;
        }

        // Populate review modal
        reviewFirstName.textContent = firstName.value.trim();
        reviewMiddleName.textContent = middleName.value.trim() || "N/A";
        reviewLastName.textContent = lastName.value.trim();
        reviewPhone.textContent = contactNumber.value.trim();
        reviewSchoolName.textContent = schoolName.value.trim();
        reviewYearLevel.textContent = yearLevel.value.trim();
        reviewAddress.textContent = address.value.trim();

        reviewModal.style.display = "flex";
    } catch (error) {
        console.error("Error displaying review modal:", error);
        alert("An error occurred while preparing the review. Please try again.");
    }
});

document.getElementById("editBtn").addEventListener("click", () => {
    reviewModal.style.display = "none";
});

document.getElementById("confirmBtn").addEventListener("click", async () => {
    if (!termsCheckbox.checked) {
        alert("Please accept the terms and conditions before proceeding.");
        return;
    }

    await saveResidentData();
    reviewModal.style.display = "none";
    alert("Your application has been submitted successfully.");
    window.location.href = "/index.html";
});

// Validation function
function validateFields() {
    if (
        !firstName.value.trim() ||
        !lastName.value.trim() ||
        !contactNumber.value.trim() ||
        !schoolName.value.trim() ||
        !yearLevel.value.trim() ||
        !address.value.trim() ||
        !data.coeUrl
    ) {
        alert("Please fill out all required fields and upload the Certificate of Enrollment.");
        return false;
    }
    return true;
}

// Save resident data to Firebase
async function saveResidentData() {
    const residentId = data.residentId || "unknown";
    const newId = await generateID();

    try {
        const residentRef = database.ref(`2-Assistance/${newId}`);
        await residentRef.set({
            firstName: firstName.value.trim(),
            middleName: middleName.value.trim(),
            lastName: lastName.value.trim(),
            contactNumber: contactNumber.value.trim(),
            schoolName: schoolName.value.trim(),
            yearLevel: yearLevel.value.trim(),
            address: address.value.trim(),
            coeUrl: data.coeUrl || null,
            status: "PENDING",
            type: "EAR",
        });
    } catch (error) {
        console.error("Error saving data:", error);
        alert("An error occurred while saving your application. Please try again.");
    }
}

// Generate unique ID
async function generateID() {
    const id = data.residentId || "unknown";
    let count = 0;

    try {
        const assistanceRef = database.ref("2-Assistance");
        const snapshot = await assistanceRef.once("value");
        snapshot.forEach((child) => {
            if (child.key.startsWith(id)) count++;
        });
        return `${id}-${1000 + count}`;
    } catch (error) {
        console.error("Error generating ID:", error);
        throw error;
    }
}

// Check for existing application
async function checkExistingApplication(residentId) {
    const assistanceRef = database.ref(`2-Assistance`);
    const snapshot = await assistanceRef.once("value");

    let existing = false;
    snapshot.forEach((child) => {
        if (child.val().residentId === residentId) existing = true;
    });
    return existing;
}

// Check last payout eligibility
async function checkLastPayoutDate(residentId) {
    const historyRef = database.ref(`2-Payout-History`);
    const snapshot = await historyRef.once("value");

    let recentPayout = false;
    snapshot.forEach((child) => {
        const data = child.val();
        if (data.residentId === residentId) {
            const lastPayoutDate = new Date(data.payoutDate);
            const now = new Date();
            const diffMonths = (now.getFullYear() - lastPayoutDate.getFullYear()) * 12 + now.getMonth() - lastPayoutDate.getMonth();
            if (diffMonths < 3) recentPayout = true;
        }
    });
    return recentPayout;
}

    </script>

</body>
</html>

